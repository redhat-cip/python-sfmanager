.\" Man page generated from reStructuredText.
.
.TH "SFMANAGER" "1" "May 24, 2016" "0.1" "sfmanager (SF client)"
.SH NAME
sfmanager \- sfmanager Documentation
.
.nr rst2man-indent-level 0
.
.de1 rstReportMargin
\\$1 \\n[an-margin]
level \\n[rst2man-indent-level]
level margin: \\n[rst2man-indent\\n[rst2man-indent-level]]
-
\\n[rst2man-indent0]
\\n[rst2man-indent1]
\\n[rst2man-indent2]
..
.de1 INDENT
.\" .rstReportMargin pre:
. RS \\$1
. nr rst2man-indent\\n[rst2man-indent-level] \\n[an-margin]
. nr rst2man-indent-level +1
.\" .rstReportMargin post:
..
.de UNINDENT
. RE
.\" indent \\n[an-margin]
.\" old: \\n[rst2man-indent\\n[rst2man-indent-level]]
.nr rst2man-indent-level -1
.\" new: \\n[rst2man-indent\\n[rst2man-indent-level]]
.in \\n[rst2man-indent\\n[rst2man-indent-level]]u
..
.sp
This documentation describes the shell utility \fBsfmanager\fP, which is a CLI for
the managesf REST API interface in Software Factory. It can be used to
administrate Software Factory, for example to manage projects and users.
.SH INTRODUCTION
.SS Global options
.sp
By default all actions require authentication as well as some information about
the remote servers.
.INDENT 0.0
.TP
.B \-\-url <\fI\%http://sfgateway.dom\fP>
URL of the managesf instance
.TP
.B \-\-auth user:password
Username and password to use when accessing the managesf interface.
This option is only valid if it is a local user within Software Factory
.UNINDENT
.sp
There are a few optional arguments as well:
.INDENT 0.0
.TP
.B \-\-insecure
Disable SSL certificate verification. Enabled by default
.TP
.B \-\-debug
Enable debug messages in console. Disabled by default
.UNINDENT
.SS Example usage
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          project create
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Help
.sp
Help is always available using the argument \(aq\-h\(aq:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager project \-h
usage: sfmanager project [\-h]
                         {delete_user,add_user,list_active_users,create,delete}
                         ...
.ft P
.fi
.UNINDENT
.UNINDENT
.SH PROJECT MANAGEMENT
.SS Create new project
.sp
SF exposes ways to create and initialize projects in Redmine and Gerrit
simultaneously. Initializing a project involves setting up the ACL and
initializing the source repository.
.sp
By default only the SF administrator will be able to create a project.
This can be unlock in the Software Factory configuration (sfconfig.yaml) to
open the project creation feature to every registered users.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          project create \-\-name <project\-name>
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
There are a few more options available in case you want to customize the
project.
.INDENT 0.0
.TP
.B \-\-description [project\-description], \-d [project\-description]
An optional description of the project.
.TP
.B \-\-upstream [GIT link], \-u [GIT link]
Uses the given repository to initalize the project, for example to reuse an existing Github repository
.TP
.B \-\-upstream\-ssh\-key upstream\-ssh\-key
SSH key for upstream repository if authentication is required
.TP
.B \-\-private
Mark project as private. In that case only members of the dev, core or ptl
group are allowed to access the project.
.TP
.B \-\-readonly
Set specific ALCs to that project to forbid patch merging. This is
a specific option to create a project that suppose to be a mirror
of another one and where you just want to store patches (eg. for packaging).
.UNINDENT
.SS Delete Project
.sp
SF exposes ways to delete projects and the groups associated with the project in
Redmine and Gerrit simultaneously.
.sp
For any project, only the PTLs shall have the permission to delete it.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          project delete \-\-name <project\-name>
.ft P
.fi
.UNINDENT
.UNINDENT
.SH GROUP MANAGEMENT
.SS Default groups
.sp
When a project is created a few default project groups are created. To modify
these groups a user needs to be at least in the same group of users.
.INDENT 0.0
.TP
.B projectname\-ptl
Group of PTLs. Members can add other users to all groups.
.TP
.B projectname\-core
Group of core reviewers. Members can add other users to the groups
projectname\-core and projectname\-dev
.TP
.B projectname\-dev
Group of developers, required when project is private. Members can not add
any other user to any group.
.UNINDENT
.SS List project users
.sp
Currently only lists all known users. This command is useful for the "add"
subcommand of the membership command or for \fI\-\-ptl\-group\fP, \fI\-\-core\-group\fP,
\fI\-\-dev\-group\fP of the project create options.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          membership list
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Add user to project groups
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          membership add \-\-user user1@tests.dom \-\-project p1 \e
          \-\-groups ptl\-group core\-group
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Remove user from project groups
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          membership remove \-\-user user1@tests.dom \-\-project p1 \e
          \-\-group ptl\-group
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
If the request does not provide a specific group to delete the user from, SF
will remove the user from all groups associated to a project.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          membership remove \-\-user user1@tests.dom \-\-project p1
.ft P
.fi
.UNINDENT
.UNINDENT
.SH USER MANAGEMENT
.sp
These commands manage the local users, that are not using external
authentication systems like Github.
.SS Add user
.sp
Creates a new local user and registers the user in Gerrit and Redmine
.INDENT 0.0
.TP
.B \-\-username [username], \-u [username]
A unique username/login
.TP
.B \-\-password [password], \-p [password]
The user password, can be provided interactively if this option is empty
.TP
.B \-\-email [email], \-e [email]
The user email
.TP
.B \-\-fullname [John Doe], \-f [John Doe]
The user\(aqs full name, defaults to username
.TP
.B \-\-ssh\-key [/path/to/pub_key], \-s [/path/to/pub_key]
The user\(aqs ssh public key file
.UNINDENT
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          user create \-\-username jdoe \-\-password secret \-\-fullname "User Tester" \e
               \-\-email jane@doe.org
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Update user
.sp
Update an existing local user. A user can update it\(aqs own details, and admins
can also update other user details. Takes the same arguments as user create.
The options \fI\-\-fullname\fP and \fI\-\-ssh\-key\fP (if updated) won\(aqt be taken in account
inside SF services. Only the password can be updated.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          user update \-\-username jdoe \-\-password unguessable
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Delete user
.sp
Disable the user\(aqs account. That does not prevent the user from contributing, it
only prevents the user from login in to Software Factory.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          user delete \-\-username jdoe
.ft P
.fi
.UNINDENT
.UNINDENT
.SH BACKUP AND RESTORE
.sp
Backups include database dumps from Gerrit, Jenkins, Mysql, cauth and managesf
as well as some important configuration files like Gerrit replication settings,
SSH keys and Hiera settings. This includes credentials; please see below how to
store backups encrypted. Because Mysql is used as the default backend in
Redmine, Paste and Etherpad all of this data is also included in the backup
file.
.SS Create a new backup
.sp
SF exposes ways to perform and retrieve a backup of all the user data store in
your SF installation. This backup can be used in case of disaster to quickly
recover user data on the same or another SF installation (of the same version).
.sp
Only the SF administrator can perform and retrieve a backup.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          system backup_start
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Once the server generated the tar file of the backup you can then download it with
the following command
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          system backup_get
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
A file called "sf_backup.tar.gz" will be created in the local directory.
.SS Restore a backup
.sp
SF exposes ways to restore a backup of all the user data store in your
SF installation. This backup can be used in case of disaster to quickly
recover user data on the same or other SF installation (in the same version).
.sp
Only the SF administrator can restore a backup.
.sp
SF allows you to restore a backup in one of the following way.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          system restore \-\-filename sf_backup.tar.gz
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Using GPG to encrypt and decrypt backups
.sp
It is recommended to store the backup files encrypted when using external
storage services, since the user and administrative credentials are included
in the backup.
When using the export_backup_swift.sh shell script included in SF, all backups
are automatically encrypted using GPG before uploading to Swift. A special
public GPG key is required for this, and it has to be stored on the SF node.
To create this key, do the following:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
gpg \-\-gen\-key  # Use "sfadmin" as name when creating the key
gpg \-\-export \-a sfadmin > sfadmin.pub
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
You have to copy this public key to the SF node, and import it as root user.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
scp sfadmin.pub root@sftests.com:.
gpg \-\-import sfadmin.pub
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Now you have to trust the imported key.
.. code\-block:: bash
.INDENT 0.0
.INDENT 3.5
gpg \-\-edit\-key sfadmin
# Enter "trust"
# Choose option 5, then exit
.UNINDENT
.UNINDENT
.sp
If you need to restore from a backup, you need to decrypt the tar.gz file first.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
gpg sf_backup.tar.gz.gpg
.ft P
.fi
.UNINDENT
.UNINDENT
.SH REQUEST A PASSWORD TO ACCESS THE GERRIT API
.sp
To request a random password to access the Gerrit API for the current user. This
is useful for using tools like  \fI\%gertty\fP .
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
               gerrit_api_htpasswd generate_password
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
and to deactivates the password from Gerrit.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
               gerrit_api_htpasswd delete_password
.ft P
.fi
.UNINDENT
.UNINDENT
.SH INITIATE THE TEST PIPELINE
.sp
Once you create a project, you can initiate the project\(aqs tests into Software
Factory\(aqs pipeline. The result is a entry into the Software Factory\(aqs
configuration repository that will require review. It will also create
placeholder scripts in your project. To skip the generation of the placeholder
just add \fI\-\-no\-scripts\fP\&.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
               tests init \-\-project prj1
.ft P
.fi
.UNINDENT
.UNINDENT
.SH AUTHOR
Red Hat
.SH COPYRIGHT
2015, 2016 Red Hat
.\" Generated by docutils manpage writer.
.
