.\" Man page generated from reStructuredText.
.
.TH "SFMANAGER" "1" "June 22, 2015" "0.3.1" "managesf"
.SH NAME
sfmanager \- sfmanager Documentation
.
.nr rst2man-indent-level 0
.
.de1 rstReportMargin
\\$1 \\n[an-margin]
level \\n[rst2man-indent-level]
level margin: \\n[rst2man-indent\\n[rst2man-indent-level]]
-
\\n[rst2man-indent0]
\\n[rst2man-indent1]
\\n[rst2man-indent2]
..
.de1 INDENT
.\" .rstReportMargin pre:
. RS \\$1
. nr rst2man-indent\\n[rst2man-indent-level] \\n[an-margin]
. nr rst2man-indent-level +1
.\" .rstReportMargin post:
..
.de UNINDENT
. RE
.\" indent \\n[an-margin]
.\" old: \\n[rst2man-indent\\n[rst2man-indent-level]]
.nr rst2man-indent-level -1
.\" new: \\n[rst2man-indent\\n[rst2man-indent-level]]
.in \\n[rst2man-indent\\n[rst2man-indent-level]]u
..
.sp
This documentation describes the shell utility \fBsfmanager\fP, which is a CLI for
the managesf REST API interface in Software Factory. It can be used to
administrate Software Factory, for example to manage projects and users.
.SH INTRODUCTION
.SS Global options
.sp
By default all actions require authentication as well as some information about
the remote servers.
.INDENT 0.0
.TP
.BI \-\-url \ <http://sfgateway.dom>
URL of the managesf instance
.UNINDENT
.INDENT 0.0
.TP
.B \-\-auth user:password
Username and password to use when accessing the managesf interface. This
option is only valid if it is a local user within Software Factory
.UNINDENT
.sp
There are a few optional arguments as well:
.INDENT 0.0
.TP
.B \-\-insecure
Disable SSL certificate verification. Enabled by default
.TP
.B \-\-debug
Enable debug messages in console. Disabled by default
.UNINDENT
.SS Example usage
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          project create
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Help
.sp
Help is always available using the argument \(aq\-h\(aq:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager project \-h
usage: sfmanager project [\-h]
                         {delete_user,add_user,list_active_users,create,delete}
                         ...
.ft P
.fi
.UNINDENT
.UNINDENT
.SH PROJECT MANAGEMENT
.SS Create new project
.sp
SF exposes ways to create and initialize projects in Redmine and Gerrit
simultaneously. Initializing a project involves setting up the ACL and
initializing the source repository.
.sp
Any user that can authenticate against SF will be able to create a project.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          project create \-\-name <project\-name>
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
There are a few more options available in case you want to customize the
project.
.INDENT 0.0
.TP
.B \-\-description [project\-description], \-d [project\-description]
An optional description of the project.
.TP
.B \-\-upstream [GIT link], \-u [GIT link]
Uses the given repository to initalize the project, for example to reuse an existing Github repository
.UNINDENT
.INDENT 0.0
.TP
.BI \-\-upstream\-ssh\-key \ upstream\-ssh\-key
SSH key for upstream repository if authentication is required
.UNINDENT
.INDENT 0.0
.TP
.B \-\-core\-group [core\-group\-members], \-c [core\-group\-members]
A list of comma\-separated member ids that are setup as core reviewers. Core
reviewers can approve or block patches; by default a review from at least
one core is required to merge a patch.
.TP
.B \-\-ptl\-group [ptl\-group\-members], \-p [ptl\-group\-members]
A list of comma\-separated member ids that are setup as PTLs (Project
Technical Lead). The members can give core permissions to other users.
.TP
.B \-\-dev\-group [dev\-group\-members], \-e [dev\-group\-members]
A list of comma\-separated member ids that are setup as developers of this
project. Only required if a project is marked private.
.UNINDENT
.INDENT 0.0
.TP
.B \-\-private
Mark project as private. In that case only members of the dev, core or ptl
group are allowed to access the project.
.UNINDENT
.SS Delete Project
.sp
SF exposes ways to delete projects and the groups associated with the project in
Redmine and Gerrit simultaneously.
.sp
For any project, only the PTLs shall have the permission to delete it.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          project delete \-\-name <project\-name>
.ft P
.fi
.UNINDENT
.UNINDENT
.SH GROUP MANAGEMENT
.SS Default groups
.sp
When a project is created a few default project groups are created. To modify
these groups a user needs to be at least in the same group of users.
.INDENT 0.0
.TP
.B projectname\-ptl
Group of PTLs. Members can add other users to all groups.
.TP
.B projectname\-core
Group of core reviewers. Members can add other users to the groups
projectname\-core and projectname\-dev
.TP
.B projectname\-dev
Group of developers, required when project is private. Members can not add
any other user to any group.
.UNINDENT
.SS Add user to project groups
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          project add_user \-\-name user1 \-\-groups p1\-ptl,p1\-core
.ft P
.fi
.UNINDENT
.UNINDENT
.SS List project users
.sp
Currently only lists all known users.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          project list_user
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Remove user from project groups
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          project delete_user \-\-name user1 \-\-group p1\-ptl
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
If the request does not provide a specific group to delete the user from, SF
will remove the user from all groups associated to a project.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          project delete_user \-\-name user1
.ft P
.fi
.UNINDENT
.UNINDENT
.SH USER MANAGEMENT
.sp
These commands manage the local users, that are not using external
authentication systems like Github.
.SS Add user
.sp
Creates a new local user and registers the user in Gerrit and Redmine
.INDENT 0.0
.TP
.B \-\-username [username], \-u [username]
A unique username/login
.TP
.B \-\-password [password], \-p [password]
The user password, can be provided interactively if this option is empty
.TP
.B \-\-email [email], \-e [email]
The user email
.TP
.B \-\-fullname [John Doe], \-f [John Doe]
The user\(aqs full name, defaults to username
.TP
.B \-\-ssh\-key [/path/to/pub_key], \-s [/path/to/pub_key]
The user\(aqs ssh public key file
.UNINDENT
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          user create \-\-username jdoe \-\-password secret \-\-email jane@doe.org
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Update user
.sp
Update an existing local user. A user can update it\(aqs own details, and admins
can also update other user details. Takes the same arguments as user create.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          user update \-\-username jdoe \-\-password unguessable
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Delete user
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          user delete \-\-username jdoe
.ft P
.fi
.UNINDENT
.UNINDENT
.SH REMOTE REPLICATION MANGEMENT
.sp
Gerrit can be configured to push merged changes to another git repository.  This
can be used to mirror changes on a public available repository, for example on
Github or to keep another copy as a backup.
.sp
Details about the configuration within Gerrit itself can be found online:
\fI\%https://gerrit.googlesource.com/gerrit/+/stable\-2.4/Documentation/config\-replication.txt\fP
.SS Add a replication config setting
.sp
The minimum requirement is to set a remote git url. Every replication target
requires it\(aqs own section within Gerrits configuration file, thus you need to
set a sectionname for each replication target.
.sp
There are a few settings you can use in a replication configuration section:
.INDENT 0.0
.TP
.B url \fI\%\(aqgerrit@$hostname\fP:/path/git/${name}.git\(aq
Set the remote url. The variable "${name}" will be replaced by the
projectname and can be used if multiple projects will be replicated by this
configuration.
Can be specified multiple times to replicate to several hosts. In this case
the option "threads" might be used to configure Gerrit to replicate in
parallel.
.TP
.B projects project1,project2
Limits the replication to the previously defined url to projects "project1,
project2". Note that there is no space between the project names.
.TP
.B push "+refs/heads/\fI:refs/heads/\fP"
refspec denoting what should be replicated. Can be specified multiple times.
.UNINDENT
.sp
Further valid setting names are: \fBreceivepack\fP, \fBuploadpack\fP, \fBtimeout\fP, \fBreplicationDelay\fP, \fBthreads\fP\&.
.sp
Example:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          replication_config add \-\-section sectionname url \(aqgerrit@$hostname:/path/git/${name}.git\(aq

sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          replication_config add \-\-section sectionname projects projectname
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Trigger replication manually
.sp
Replication is triggered automatically by default, though Gerrit delays this a
little bit (15 seconds by default) to batch multiple commits into a single push operation.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          trigger_replication \-\-project config
.ft P
.fi
.UNINDENT
.UNINDENT
.SS List existing replication configs and settings
.sp
Existing replication configuration can be shown using the two commands \fBlist\fP
and \fBget\-all\fP\&. The first command lists all configured replications that the user
has access to, the second command lists only settings from a specific
configuration section and can be filtered to a single setting too.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          replication_config list

sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          get\-all \-\-section sectionname

sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          get\-all \-\-section sectionname url
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Delete replication config
.sp
Deleting a replication target only stops replicating data to this target. It
does not remove data on the remote side.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          remove\-section sectionname
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Modify existing settings
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          replication_config replace\-all \-\-section sectionname projects project1,project3
.ft P
.fi
.UNINDENT
.UNINDENT
.SS Using SSH keys to authenticate replication
.sp
Gerrit reads ~/.ssh/config on startup and uses defined configuration settings
when connecting to remote replication targets. Authentication is done using SSH
keys, thus they need to be defined first.
Some replication sites don\(aqt allow to re\-use a single SSH key for authentication
with different repositories, for example Github. In that case you can define
multiple different SSH keys, and instead of directly using a hostname you only
define an alias for the "Host" value. The SSH keys have to be created on the
Gerrit node or need to be copied there.
.sp
An example setting for an alias host might look like this:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
Host alias_gh_firstrepo
   Hostname github.com
   User remoteuser
   IdentityFile ~/.ssh/gh_firstrepo
   PreferredAuthentications publickey

Host alias_gh_secondrepo
   Hostname github.com
   User remoteuser
   IdentityFile ~/.ssh/gh_secondrepo
   PreferredAuthentications publickey
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
The corresponding Gerrit replication can be created using the following URLs:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          replication_config add \-\-section firstrepo url \(aqgit@alias_gh_firstrepo:accountname/${name}.git\(aq

sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          replication_config add \-\-section firstrepo projects projectname1

sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          replication_config add \-\-section secondrepo url \(aqgit@alias_gh_secondrepo:accountname/${name}.git\(aq

sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          replication_config add \-\-section secondrepo projects projectname2
.ft P
.fi
.UNINDENT
.UNINDENT
.SH BACKUP AND RESTORE
.sp
Backups include data from Gerrit, Jenkins and Mysql. Because Mysql is used as
the default backend in Redmine, Paste and Etherpad all of this data is also
included in the backup file.
.SS Create a new backup
.sp
SF exposes ways to perform and retrieve a backup of all the user data store in
your SF installation. This backup can be used in case of disaster to quickly
recover user data on the same or another SF installation (of the same version).
.sp
Only the SF administrator can perform and retrieve a backup.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          backup_get
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
A file called "sf_backup.tar.gz" will be created in the local directory.
.SS Restore a backup
.sp
SF exposes ways to restore a backup of all the user data store in your
SF installation. This backup can be used in case of disaster to quickly
recover user data on the same or other SF installation (in the same version).
.sp
Only the SF administrator can restore a backup.
.sp
SF allows you to restore a backup in one of the following way.
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
sfmanager \-\-url <http://sfgateway.dom> \-\-auth user:password \e
          restore \-\-filename sf_backup.tar.gz
.ft P
.fi
.UNINDENT
.UNINDENT
.SH AUTHOR
Red Hat
.SH COPYRIGHT
2015, Red Hat
.\" Generated by docutils manpage writer.
.
